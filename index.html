<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="Title/Carousel.png" />
    <link rel="stylesheet" href="style.css" />
    <title>CSS & Javascript Carousel</title>
  </head>
  <body>
    <div class="container">
      <h1 class="carousel-title">CSS & Javascript Carousel</h1>
      <div class="carousel-wrapper">
        <button class="carousel-btn left-btn" disabled>←</button>
        <div class="carousel">
          <div class="Card">
            <img src="images/3.jpg" alt="Image 3" />
          </div>
          <div class="Card">
            <video src="images/12.mp4" autoplay muted loop></video>
          </div>
          <div class="Card">
            <img src="images/7.jpg" alt="Image 7" />
          </div>
          <div class="Card">
            <video src="images/14.mp4" autoplay muted loop></video>
          </div>
          <div class="Card">
            <img src="images/1.jpg" alt="Image 1" />
          </div>
          <div class="Card">
            <img src="images/9.jpg" alt="Image 9" />
          </div>
          <div class="Card">
            <video src="images/11.mp4" autoplay muted loop></video>
          </div>
          <div class="Card">
            <img src="images/5.jpg" alt="Image 5" />
          </div>
          <div class="Card">
            <img src="images/2.jpg" alt="Image 2" />
          </div>
          <div class="Card">
            <video src="images/15.mp4" autoplay muted loop></video>
          </div>
          <div class="Card">
            <img src="images/8.jpg" alt="Image 8" />
          </div>
          <div class="Card">
            <img src="images/4.jpg" alt="Image 4" />
          </div>
          <div class="Card">
            <video src="images/13.mp4" autoplay muted loop></video>
          </div>
          <div class="Card">
            <img src="images/10.jpg" alt="Image 10" />
          </div>
          <div class="Card">
            <video src="images/6.mp4" autoplay muted loop></video>
          </div>
        </div>
        <button class="carousel-btn right-btn">→</button>
      </div>

      <div class="carousel-dots"></div>
    </div>

    <script>
      const carousel = document.querySelector(".carousel");
      const leftBtn = document.querySelector(".left-btn");
      const rightBtn = document.querySelector(".right-btn");
      const dotsContainer = document.querySelector(".carousel-dots");
      const cards = document.querySelectorAll(".Card");

      // 1. Create dots - exactly one per card
      dotsContainer.innerHTML = ""; // Clear existing to prevent duplicates
      cards.forEach((_, index) => {
        const dot = document.createElement("span");
        dot.classList.add("dot");
        if (index === 0) dot.classList.add("active");
        dot.addEventListener("click", () => {
          cards[index].scrollIntoView({
            behavior: "smooth",
            inline: "center",
            block: "nearest",
          });
        });
        dotsContainer.appendChild(dot);
      });

      const dots = document.querySelectorAll(".dot");

      // 2. Improved Dot Update Logic
      function updateDots() {
        const scrollLeft = carousel.scrollLeft;
        const maxScroll = carousel.scrollWidth - carousel.clientWidth;

        let closestIndex = 0;

        // Edge case: Start of carousel -> First dot
        if (scrollLeft <= 10) {
          closestIndex = 0;
        }
        // Edge case: End of carousel -> Last dot
        else if (scrollLeft >= maxScroll - 10) {
          closestIndex = cards.length - 1;
        }
        // Middle: Center-based detection
        else {
          const carouselRect = carousel.getBoundingClientRect();
          const carouselCenter = carouselRect.left + carouselRect.width / 2;
          let minDistance = Infinity;

          cards.forEach((card, index) => {
            const cardRect = card.getBoundingClientRect();
            const cardCenter = cardRect.left + cardRect.width / 2;
            const distance = Math.abs(carouselCenter - cardCenter);

            if (distance < minDistance) {
              minDistance = distance;
              closestIndex = index;
            }
          });
        }

        dots.forEach((dot, index) => {
          dot.classList.toggle("active", index === closestIndex);
        });
      }

      carousel.addEventListener("scroll", updateDots);

      // 3. Update button states
      function updateButtons() {
        const maxScroll = carousel.scrollWidth - carousel.clientWidth;
        leftBtn.disabled = carousel.scrollLeft <= 5;
        rightBtn.disabled = carousel.scrollLeft >= maxScroll - 5;
      }

      carousel.addEventListener("scroll", updateButtons);
      updateButtons();

      // 4. Navigation Buttons
      const scrollNext = (direction) => {
        const cardWidth = cards[0].offsetWidth + 24; // Card + Gap

        if (direction === "right") {
          carousel.scrollBy({ left: cardWidth, behavior: "smooth" });
        } else {
          carousel.scrollBy({ left: -cardWidth, behavior: "smooth" });
        }
      };

      rightBtn.addEventListener("click", () => scrollNext("right"));
      leftBtn.addEventListener("click", () => scrollNext("left"));

      // 5. Keyboard Navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") scrollNext("left");
        if (e.key === "ArrowRight") scrollNext("right");
      });
    </script>
  </body>
</html>
